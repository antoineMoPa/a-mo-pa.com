<!DOCTYPE html>
<html>
<head>
    <title>.js sound playground</title>
    <link rel='stylesheet' media='all' href='assets/css/normalize.css'>
    <link rel='stylesheet' media='all' href='assets/css/sound.css'>
    <link rel='stylesheet' media='all' href='assets/lib/codemirror.css'>
    
    <meta charset='utf-8'>
    <script src="assets/js/q.js"></script>
    <script src="assets/lib/riffwave.js"></script>
    <script src="assets/lib/codemirror-compressed.js"></script>
    <script src="assets/js/sound.js"></script>
</head>
<body>

<a href='index.html' class='button back-to-home'>Back to my homepage</a>

<div class='col full-width'>
    <h3>Introduction</h3>
    <p>This is a tool to play with javascript and sound. it includes the <a href="http://codebase.es/riffwave/" target="_blank" >riffwave.js</a> library by Pedro Ladaria.</p>
    <p>Press Shift+Enter to run code</p>
</div>

<div class="controls">
    <div class="col half-width">
        
<textarea id="sound-code">
// Sample code
// Produces a sine wave with a frequency of 220 hz (LA [A])
var data = [];

var length = 44100;
var frequency = 220;
var second = 44100;
var PI = Math.PI;

for (var i = 0; i < length; i++){
    // Physics & math: 
    // y = A cos (ωt)
    // ω = 2πf
    // t = i / [samples per second]
    // data[i] = y = A cos (2πf*(i/seconds))
    data[i] = 127 + 
        Math.round(
            127 * Math.cos(2*Math.PI*frequency*(i/second))
        );
}

var wave = new RIFFWAVE(); // create the wave file
wave.header.sampleRate = second;
wave.header.numChannels = 1;
wave.Make(data);
var audio = new Audio(wave.dataURI); // create the HTML5 audio element

audio.play(); // some noise
</textarea>
    <div class='text-right'>
        <a class='button run-code'>Run!</a>
    </div>
    </div>
    <div class="col half-width">
        <pre class="log"></pre>
        <div class='text-right'>
            <a class="button clear-log">
                Clear log
            </a>
        </div>
    </div>
    <div class="col full-width">
        <h3>Beware of errors</h3>
        <p>Make sure your values are between 0 and 254, or else weird things will happen.</p>
<h3>Doppler effect simulation</h3>

<pre class='code'>
var data = [];

var length = 184100;
var second = 44100;
var PI = Math.PI;

// Note: you have to change the sign of v and vf depending on
// how the speeds influence the frequency.

var vo = 0; // speeds are in m/s. this is the speed of the observer
var vs = 27.7;  // speed of the source
var v = 343; // speed of sound

var f = 340; // Source frequency

for (var i = 0; i < length; i++){
    if(i > length/2){
        vs = -27.7;
    }
    
    var fprime = f * (v + vo)/(v - vs);
    
    data[i] = 127 + 
        Math.round(
            127 * Math.sin(2*Math.PI*(fprime)*(i/second))
        );
}

var wave = new RIFFWAVE();
wave.header.sampleRate = second;
wave.header.numChannels = 1;
wave.Make(data);
var audio = new Audio(wave.dataURI);

audio.play(); // some noise
</pre>

<h3>Sounds from another planet</h3>

<p>This is just the sum of many cosinuses with parameters that change with for every sample.</p>

<pre class='code'>
var data = [];

var length = 104100;
var frequency = 220;
var second = 44100;
var PI = Math.PI;

for (var i = 0; i < length; i++){
    data[i] = 127 + 
        Math.round(
            23 * Math.cos(2*Math.PI*(i*i/20000)*(i/second)) + 
                23 * Math.cos(2*Math.PI*(i%72)*(i/second)) +
                23 * Math.cos(2*Math.PI*(i/83)*(i/second)) +
                23 * Math.cos(2*Math.PI*(i%94)*(i/second)) +
                23 * Math.cos(2*Math.PI*(i/105)*(i/second))
        );
}

var wave = new RIFFWAVE();
wave.header.sampleRate = second;
wave.header.numChannels = 1;
wave.Make(data);
var audio = new Audio(wave.dataURI);

audio.play();
</pre>

<h3>Beats</h3>
<pre class='code'>
// Both sinuses start at same frequency.
// Second frequency augments by a factor i/second*8 (8 Hz/second),
// So we can see a beat appearing and 
// transforming itself into a third sin
var data = [];

var length = 384100;
var second = 44100;

var f = 340;

for (var i = 0; i < length; i++){
    // Here are our 2 sinuses
    data[i] = 43 + 
        Math.round(
            43 * Math.sin(2*Math.PI*(f)*(i/second))
        ) + 
                    43 + 
        Math.round(
            43 * Math.sin(2*Math.PI*(f+i/second*8)*(i/second))
        );
}

var wave = new RIFFWAVE();
wave.header.sampleRate = second;
wave.header.numChannels = 1;
wave.Make(data);
var audio = new Audio(wave.dataURI);

audio.play(); // some noise
</pre>

<h3>Dephased waves: 2 waves fighting against each other!</h3>

<p>With 2 speakers, this example should cause 2 waves to interfere with each other. At some places, the waves will cancel each other. At some other places, the 2 waves will be combined into a single wave of a greater amplitude.</p>

<p>You should be able to move around your computer room and hear different sound intensities.</p>

<pre class='code'>
var data = [];

var length = 2384100;
var second = 44100;

var f = 340;

for (var i = 0; i < length; i += 2){
    data[i] = 127 + 
        Math.round(
            127 * Math.sin(2*Math.PI*(f)*(i/second))
        );
    // This wave is the same as the last one, 
    // but with a phase constant of π
    // So when the last sample is 1, this one is -1
    data[i+1] = 127 + 
        Math.round(
            127 * Math.sin(2*Math.PI*(f)*(i/second)  + Math.PI)
        );
}

var wave = new RIFFWAVE();
wave.header.sampleRate = second;
wave.header.numChannels = 2;
wave.Make(data);
var audio = new Audio(wave.dataURI);

audio.play(); // some noise
</pre>
  
    </div>

</div>

<script>$.ready();</script>
</body>
</html>
